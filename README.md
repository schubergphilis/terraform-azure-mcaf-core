# terraform-azure-mcaf-core
Terraform module to create the Core component of each workload, currently only implements Terraform-azure-mcaf-key-vault

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.9 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | >= 4, < 5.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | >= 4, < 5.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_boot_diag_storage_account"></a> [boot\_diag\_storage\_account](#module\_boot\_diag\_storage\_account) | github.com/schubergphilis/terraform-azure-mcaf-storage-account.git | v0.7.0 |
| <a name="module_container_registry"></a> [container\_registry](#module\_container\_registry) | github.com/schubergphilis/terraform-azure-mcaf-container-registry.git | v0.1.3 |
| <a name="module_keyvault_with_cmk"></a> [keyvault\_with\_cmk](#module\_keyvault\_with\_cmk) | github.com/schubergphilis/terraform-azure-mcaf-key-vault.git | v0.3.2 |
| <a name="module_recovery_services_vault"></a> [recovery\_services\_vault](#module\_recovery\_services\_vault) | github.com/schubergphilis/terraform-azure-mcaf-recoveryservicesvault.git | v0.3.0 |

## Resources

| Name | Type |
|------|------|
| [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) | resource |
| [azurerm_client_config.current](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/client_config) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_key_vault"></a> [key\_vault](#input\_key\_vault) | # Key Vault variables | <pre>object({<br/>    name                            = string<br/>    enabled_for_disk_encryption     = optional(bool, false)<br/>    enabled_for_deployment          = optional(bool, false)<br/>    enabled_for_template_deployment = optional(bool, false)<br/>    enable_rbac_authorization       = optional(bool, true)<br/>    purge_protection                = optional(bool, true)<br/>    soft_delete_retention_days      = optional(number, 30)<br/>    sku                             = optional(string, "standard")<br/>    public_network_access_enabled   = optional(bool, false)<br/>    ip_rules                        = optional(set(string), [])<br/>    subnet_ids                      = optional(set(string), [])<br/>    network_bypass                  = optional(string, "None")<br/>    cmk_keys_create                 = optional(bool, true)<br/>    cmkrsa_key_name                 = optional(string, "cmkrsa")<br/>    cmkec_key_name                  = optional(string, "cmkec")<br/>    cmk_rotation_period             = optional(string, "P18M")<br/>    cmk_expiry_period               = optional(string, "P2Y")<br/>    cmk_notify_period               = optional(string, "P30D")<br/>    cmk_expiration_date             = optional(string, null)<br/>    tags                            = optional(map(string), {})<br/>  })</pre> | n/a | yes |
| <a name="input_location"></a> [location](#input\_location) | Location of the resources to create | `string` | n/a | yes |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | The name of the resource group in which to create the resources. | `string` | n/a | yes |
| <a name="input_boot_diag_storage_account"></a> [boot\_diag\_storage\_account](#input\_boot\_diag\_storage\_account) | Configure a Boot diagnostics Storage Account for the subscription, Boot Diagnostics Storage Accounts must be publically accessible, do not support Zone Redundant Storage and do not support storage tiering settings | <pre>object({<br/>    name                              = string<br/>    account_tier                      = optional(string, "Standard")<br/>    account_replication_type          = optional(string, "LRS")<br/>    access_tier                       = optional(string, "Hot")<br/>    infrastructure_encryption_enabled = optional(bool, true)<br/>    cmk_encryption_enabled            = optional(bool, false)<br/>    system_assigned_identity_enabled  = optional(bool, false)<br/>    user_assigned_identities          = optional(set(string), [])<br/>    ip_rules                          = optional(set(string), null)<br/>    storage_management_policy = optional(object({<br/>      blob_delete_retention_days      = optional(number, 90)<br/>      container_delete_retention_days = optional(number, 90)<br/>    }), null)<br/>    immutability_policy = optional(object({<br/>      state                         = optional(string, "Unlocked")<br/>      allow_protected_append_writes = optional(bool, true)<br/>      period_since_creation_in_days = optional(number, 14)<br/>    }), null)<br/>    tags = optional(map(string), {})<br/>  })</pre> | `null` | no |
| <a name="input_container_registry"></a> [container\_registry](#input\_container\_registry) | Configuration for the Azure Container Registry | <pre>object({<br/>    name                             = string<br/>    sku                              = optional(string, "Premium")<br/>    anonymous_pull_enabled           = optional(bool, false)<br/>    quarantine_policy_enabled        = optional(bool, false)<br/>    admin_enabled                    = optional(bool, false)<br/>    public_network_access_enabled    = optional(bool, false)<br/>    network_rule_bypass_option       = optional(string, "None")<br/>    enable_trust_policy              = optional(bool, false)<br/>    export_policy_enabled            = optional(bool, false)<br/>    retention_policy_in_days         = optional(number, 7)<br/>    system_assigned_identity_enabled = optional(bool, false)<br/>    user_assigned_identities         = optional(set(string), [])<br/>    cmk_encryption_enabled           = optional(bool, false)<br/>    cmk_identity_id                  = optional(string, null)<br/>    georeplications = optional(list(object({<br/>      location                  = string<br/>      regional_endpoint_enabled = optional(bool, true)<br/>      zone_redundancy_enabled   = optional(bool, true)<br/>      tags                      = optional(map(any), null)<br/>    })), [])<br/>    zone_redundancy_enabled = optional(bool, true)<br/>    role_assignments = optional(map(object({<br/>      principal_id         = string<br/>      role_definition_name = string<br/>    })))<br/>    tags = optional(map(string), {})<br/>  })</pre> | `null` | no |
| <a name="input_file_share_backup_policy"></a> [file\_share\_backup\_policy](#input\_file\_share\_backup\_policy) | A map objects for backup and retation options.<br/><br/>    - `name` - (Optional) The name of the private endpoint. One will be generated if not set.<br/>    - `role_assignments` - (Optional) A map of role assignments to create on the <br/><br/>    - `backup` - (required) backup options.<br/>        - `frequency` - (Required) Sets the backup frequency. Possible values are hourly, Daily and Weekly.<br/>        - `time` - (required) Specify time in a 24 hour format HH:MM. "22:00"<br/>        - `hour_interval` - (Optional) Interval in hour at which backup is triggered. Possible values are 4, 6, 8 and 12. This is used when frequency is hourly. 6<br/>        - `hour_duration` -  (Optional) Duration of the backup window in hours. Possible values are between 4 and 24 This is used when frequency is hourly. 12<br/>        - `weekdays` -  (Optional) The days of the week to perform backups on. Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday or Saturday. This is used when frequency is Weekly. ["Tuesday", "Saturday"]<br/>    - `retention_daily` - (Optional)<br/>      - `count` - <br/>    - `retantion_weekly` -<br/>      - `count` -<br/>      - `weekdays` -<br/>    - `retantion_monthly` -<br/>      - `count` -  # (Required) The number of monthly backups to keep. Must be between 1 and 9999<br/>      - `weekdays` - (Optional) The weekday backups to retain . Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday or Saturday.<br/>      - `weeks` -  # (Optional) The weeks of the month to retain backups of. Must be one of First, Second, Third, Fourth, Last.<br/>      - `days` -  # (Optional) The days of the month to retain backups of. Must be between 1 and 31.<br/>      - `include_last_days` -  # (Optional) Including the last day of the month, default to false.<br/>    - `retantion_yearly` -<br/>      - `months` - # (Required) The months of the year to retain backups of. Must be one of January, February, March, April, May, June, July, August, September, October, November and December.<br/>      - `count` -  # (Required) The number of monthly backups to keep. Must be between 1 and 9999<br/>      - `weekdays` - (Optional) The weekday backups to retain . Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday or Saturday.<br/>      - `weeks` -  # (Optional) The weeks of the month to retain backups of. Must be one of First, Second, Third, Fourth, Last.<br/>      - `days` -  # (Optional) The days of the month to retain backups of. Must be between 1 and 31.<br/>      - `include_last_days` -  # (Optional) Including the last day of the month, default to false.<br/><br/>    example:<br/>      retentions = {<br/>      rest1 = {<br/>        backup = {<br/>          frequency     = "hourly"<br/>          time          = "22:00"<br/>          hour\_interval = 6<br/>          hour\_duration = 12<br/>          # weekdays      = ["Tuesday", "Saturday"]<br/>        }<br/>        retention\_daily = 7<br/>        retention\_weekly = {<br/>          count    = 7<br/>          weekdays = ["Monday", "Wednesday"]<br/><br/>        }<br/>        retention\_monthly = {<br/>          count = 5<br/>          # weekdays =  ["Tuesday","Saturday"]<br/>          # weeks = ["First","Third"]<br/>          days = [3, 10, 20]<br/>        }<br/>        retention\_yearly = {<br/>          count  = 5<br/>          months = []<br/>          # weekdays =  ["Tuesday","Saturday"]<br/>          # weeks = ["First","Third"]<br/>          days = [3, 10, 20]<br/>        }<br/><br/>        }<br/>      } | <pre>map(object({<br/>    name            = string<br/>    timezone        = string<br/>    frequency       = string<br/>    retention_daily = optional(number, null)<br/><br/>    backup = object({<br/>      time = string<br/>      hourly = optional(object({<br/>        interval        = number<br/>        start_time      = string<br/>        window_duration = number<br/>      }))<br/>    })<br/><br/>    retention_weekly = optional(object({<br/>      count    = optional(number, 7)<br/>      weekdays = optional(list(string), [])<br/>    }), {})<br/><br/>    retention_monthly = optional(object({<br/>      count             = optional(number, 0)<br/>      weekdays          = optional(list(string), [])<br/>      weeks             = optional(list(string), [])<br/>      days              = optional(list(number), [])<br/>      include_last_days = optional(bool, false)<br/>    }), {})<br/><br/>    retention_yearly = optional(object({<br/>      count             = optional(number, 0)<br/>      months            = optional(list(string), [])<br/>      weekdays          = optional(list(string), [])<br/>      weeks             = optional(list(string), [])<br/>      days              = optional(list(number), [])<br/>      include_last_days = optional(bool, false)<br/>    }), {})<br/>  }))</pre> | `{}` | no |
| <a name="input_key_vault_key"></a> [key\_vault\_key](#input\_key\_vault\_key) | This map describes the configuration for Azure Key Vault keys.<br/><br/>- `key_vault_id` - (Required) The ID of the Key Vault.<br/>- `key_type` - (Required) The type of the key.<br/>- `key_size` - (Required) The size of the key.<br/>- `key_opts` - (Required) The key operations that are permitted.<br/><br/>Example Inputs:<pre>hcl<br/>  key_vault_key = {<br/>    key_rsa = {<br/>      type = "RSA"<br/>      size = 4096<br/>      opts = ["encrypt", "decrypt", "sign", "verify", "wrapKey", "unwrapKey"]<br/>    }<br/>    key_ec = {<br/>      type = "EC"<br/>      curve = "P-256"<br/>      opts = ["sign", "verify"]<br/>    }<br/>  }</pre> | <pre>map(object({<br/>    name            = optional(string, null)<br/>    curve           = optional(string, null)<br/>    size            = optional(number, null)<br/>    type            = optional(string, null)<br/>    opts            = optional(set(string), null)<br/>    expiration_date = optional(string, null)<br/>    not_before_date = optional(string, null)<br/>    rotation_policy = optional(object({<br/>      automatic = optional(object({<br/>        time_after_creation = optional(string, null)<br/>        time_before_expiry  = optional(string, null)<br/>      }), null)<br/>      expire_after         = optional(string, null)<br/>      notify_before_expiry = optional(string, null)<br/>    }), null)<br/>    tags = optional(map(string), {})<br/>  }))</pre> | `{}` | no |
| <a name="input_recovery_services_vault"></a> [recovery\_services\_vault](#input\_recovery\_services\_vault) | n/a | <pre>object({<br/>    name                             = string<br/>    public_network_access_enabled    = optional(bool, false)<br/>    sku                              = optional(string, "Standard")<br/>    storage_mode_type                = optional(string, "GeoRedundant")<br/>    cross_region_restore_enabled     = optional(bool, false)<br/>    soft_delete_enabled              = optional(bool, true)<br/>    system_assigned_identity_enabled = optional(bool, true)<br/>    user_assigned_identities         = optional(set(string), [])<br/>    cmk_identity_id                  = optional(string, null)<br/>    cmk_encryption_enabled           = optional(bool, false)<br/>    immutability                     = optional(string, null)<br/>    tags                             = optional(map(string), {})<br/>  })</pre> | `null` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | A map of tags to assign to the resource. | `map(string)` | `{}` | no |
| <a name="input_vm_backup_policy"></a> [vm\_backup\_policy](#input\_vm\_backup\_policy) | A map of objects for backup and retention options.<br/><br/>    - `name` - (Required) The name of the backup policy.<br/>    - `timezone` - (Required) The timezone for the backup policy.<br/>    - `instant_restore_retention_days` - (Optional) The number of days to retain instant restore points.<br/>    - `instant_restore_resource_group` - (Optional) A map of resource group options for instant restore.<br/>        - `prefix` - (Optional) Prefix for the resource group name.<br/>        - `suffix` - (Optional) Suffix for the resource group name.<br/>    - `policy_type` - (Required) The type of the backup policy.<br/>    - `frequency` - (Required) The frequency of the backup. Possible values are Hourly, Daily, and Weekly.<br/><br/>    - `backup` - (Required) Backup options.<br/>        - `time` - (Required) Specify time in a 24-hour format HH:MM. Example: "22:00".<br/>        - `hour_interval` - (Optional) Interval in hours at which backup is triggered. Possible values are 4, 6, 8, and 12. This is used when frequency is Hourly.<br/>        - `hour_duration` - (Optional) Duration of the backup window in hours. Possible values are between 4 and 24. This is used when frequency is Hourly.<br/>        - `weekdays` - (Optional) The days of the week to perform backups on. Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, or Saturday. This is used when frequency is Weekly.<br/><br/>    - `retention_daily` - (Optional) The number of daily backups to retain.<br/>    - `retention_weekly` - (Optional) A map of weekly retention options.<br/>        - `count` - (Optional) The number of weekly backups to retain.<br/>        - `weekdays` - (Optional) The weekdays to retain backups. Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, or Saturday.<br/>    - `retention_monthly` - (Optional) A map of monthly retention options.<br/>        - `count` - (Required) The number of monthly backups to retain. Must be between 1 and 9999.<br/>        - `weekdays` - (Optional) The weekdays to retain backups. Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, or Saturday.<br/>        - `weeks` - (Optional) The weeks of the month to retain backups. Must be one of First, Second, Third, Fourth, Last.<br/>        - `days` - (Optional) The days of the month to retain backups. Must be between 1 and 31.<br/>        - `include_last_days` - (Optional) Include the last day of the month. Defaults to false.<br/>    - `retention_yearly` - (Optional) A map of yearly retention options.<br/>        - `count` - (Required) The number of yearly backups to retain. Must be between 1 and 9999.<br/>        - `months` - (Required) The months of the year to retain backups. Must be one of January, February, March, April, May, June, July, August, September, October, November, or December.<br/>        - `weekdays` - (Optional) The weekdays to retain backups. Must be one of Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, or Saturday.<br/>        - `weeks` - (Optional) The weeks of the month to retain backups. Must be one of First, Second, Third, Fourth, Last.<br/>        - `days` - (Optional) The days of the month to retain backups. Must be between 1 and 31.<br/>        - `include_last_days` - (Optional) Include the last day of the month. Defaults to false.<br/><br/>    Example:<br/>      vm\_backup\_policy = {<br/>        example\_policy = {<br/>          name                           = "example\_policy"<br/>          timezone                       = "UTC"<br/>          policy\_type                    = "VMBkp"<br/>          frequency                      = "Hourly"<br/>          backup = {<br/>            time          = "22:00"<br/>            hour\_interval = 6<br/>            hour\_duration = 12<br/>          }<br/>          retention\_daily = 7<br/>          retention\_weekly = {<br/>            count    = 7<br/>            weekdays = ["Monday", "Wednesday"]<br/>          }<br/>          retention\_monthly = {<br/>            count    = 5<br/>            days     = [3, 10, 20]<br/>          }<br/>          retention\_yearly = {<br/>            count  = 5<br/>            months = ["January", "July"]<br/>            days   = [3, 10, 20]<br/>          }<br/>        }<br/>      } | <pre>map(object({<br/>    name                           = string<br/>    timezone                       = string<br/>    instant_restore_retention_days = optional(number, null)<br/>    policy_type                    = string<br/>    frequency                      = string<br/><br/>    retention_daily = optional(number, null)<br/><br/>    backup = object({<br/>      time          = string<br/>      hour_interval = optional(number, null)<br/>      hour_duration = optional(number, null)<br/>      weekdays      = optional(list(string), [])<br/>    })<br/><br/>    retention_weekly = optional(object({<br/>      count    = optional(number, 7)<br/>      weekdays = optional(list(string), [])<br/>    }), {})<br/><br/>    retention_monthly = optional(object({<br/>      count             = optional(number, 0)<br/>      weekdays          = optional(list(string), [])<br/>      weeks             = optional(list(string), [])<br/>      days              = optional(list(number), [])<br/>      include_last_days = optional(bool, false)<br/>    }), {})<br/><br/>    retention_yearly = optional(object({<br/>      count             = optional(number, 0)<br/>      months            = optional(list(string), [])<br/>      weekdays          = optional(list(string), [])<br/>      weeks             = optional(list(string), [])<br/>      days              = optional(list(number), [])<br/>      include_last_days = optional(bool, false)<br/>    }), {})<br/>  }))</pre> | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_cmkrsa_id"></a> [cmkrsa\_id](#output\_cmkrsa\_id) | CMK RSA Key ID |
| <a name="output_cmkrsa_key_name"></a> [cmkrsa\_key\_name](#output\_cmkrsa\_key\_name) | CMK RSA Key Name |
| <a name="output_cmkrsa_resource_resource_id"></a> [cmkrsa\_resource\_resource\_id](#output\_cmkrsa\_resource\_resource\_id) | CMK RSA Key Resource ID |
| <a name="output_cmkrsa_resource_versionless_id"></a> [cmkrsa\_resource\_versionless\_id](#output\_cmkrsa\_resource\_versionless\_id) | CMK RSA Key ID |
| <a name="output_cmkrsa_versionless_id"></a> [cmkrsa\_versionless\_id](#output\_cmkrsa\_versionless\_id) | CMK RSA Key ID |
| <a name="output_container_registry_id"></a> [container\_registry\_id](#output\_container\_registry\_id) | n/a |
| <a name="output_key_vault_id"></a> [key\_vault\_id](#output\_key\_vault\_id) | n/a |
| <a name="output_key_vault_name"></a> [key\_vault\_name](#output\_key\_vault\_name) | n/a |
| <a name="output_key_vault_uri"></a> [key\_vault\_uri](#output\_key\_vault\_uri) | n/a |
| <a name="output_recovery_services_vault_id"></a> [recovery\_services\_vault\_id](#output\_recovery\_services\_vault\_id) | The Recovery Services Vault ID |
| <a name="output_resource_group_id"></a> [resource\_group\_id](#output\_resource\_group\_id) | ID of the Resource Group created by the module |
| <a name="output_storage_account_id"></a> [storage\_account\_id](#output\_storage\_account\_id) | n/a |
<!-- END_TF_DOCS -->